"use strict";$(document).ready(function(){for(var eventsForStyle=["load","resize"],i=0;i<eventsForStyle.length;i++)window.addEventListener(eventsForStyle[i],function(){var vh=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(vh,"px"))});$("html").tooltip({selector:'[data-toggle="tooltip"]'}),$(function(){$('[data-toggle="tooltip"]').tooltip()}),$(".dropdown-menu").click(function(e){e.stopPropagation()}),$(".sidebarBtn").click(function(){$("#sidebar").toggleClass("show"),$(this).toggleClass("toggled")});var $flowchart=$("#chart"),$container=$flowchart.parent(),$lastEvent=($(".draggable_operator"),$(".sidebar__log")),cx=($(".sidebar__log"),$flowchart.width()/2),cy=$flowchart.height()/2,possibleZooms=[.5,.75,1,2],currentZoom=.5;$flowchart.panzoom(),$flowchart.panzoom("pan",-cx+$container.width()/2,-cy+$container.height()/2),$container.on("mousewheel.focal",function(e){e.preventDefault();var delta=e.delta||e.originalEvent.wheelDelta||e.originalEvent.detail,zoomOut=delta?delta<0:e.originalEvent.deltaY>0;currentZoom=Math.max(0,Math.min(possibleZooms.length-1,currentZoom+(2*zoomOut-1))),$flowchart.flowchart("setPositionRatio",possibleZooms[currentZoom]),$flowchart.panzoom("zoom",possibleZooms[currentZoom],{animate:!0})}),$(window).on("resize",function(){$flowchart.panzoom("resetDimensions"),$flowchart.panzoom("pan",-cx+$container.width()/2,-cy+$container.height()/2)}),$("#resetZoom").on("click",function(){$flowchart.panzoom("pan",-cx+$container.width()/2,-cy+$container.height()/2),$flowchart.panzoom("zoom",.5,{animate:!0})}),$flowchart.flowchart({canUserMoveOperators:!1,canUserEditLinks:!1,linkWidth:3,multipleLinksOnInput:!0,multipleLinksOnOutput:!0,verticalConnection:!0,linkVerticalDecal:0,defaultLinkColor:"#2CACDE",defaultSelectedLinkColor:"#245B8F",onOperatorSelect:function(operatorId){var txt;return txt='<div class="log"> <div class="log-title"><span>Select '.concat(operatorId,".</span>\n        ").concat($flowchart.flowchart("getOperatorTitle",operatorId),'</div>\n        <div class="log-desc">').concat($flowchart.flowchart("getOperatorData",operatorId).info.description,'</div>\n        <div class="log-stats">\n          Some statistic: Number of this point is <span> ').concat($flowchart.flowchart("getOperatorData",operatorId).info.numb," </span>.\n        </div>\n        </div>"),$lastEvent.html(txt),console.log($flowchart.flowchart("getOperatorData",operatorId)),!0}});function loadPool(){$.get("/api/poolList",function(data){console.log(data);for(var container=$("#poolList"),_i=0;_i<data.length;_i++){var el=data[_i],block='\n            <div class="list-group-item list-group-item-action d-flex justify-content-between flex-row align-items-center py-0 px-2  '.concat("busy"==el.status?"busy":"",'">\n              <button onclick="selectedPool=\'').concat(el._id,"';\n              $.get('/api/poolAggregate?idpool=").concat(el._id,"',function (data) {\n                $('#chart').flowchart('setData', data) }, 'json');  \n                $('#headerTitle').html('").concat(el.name,'\');\n                " class="list-group-item-button" style="color: inherit">\n                <div class="d-flex w-100 alighn-items-center flex-column">\n                  <h6 class="list-group-item-name">').concat(el.name,"</h6>\n                  ").concat(el.description?'<small class="list-group-item-desc">'+el.description+"</small>":"",'\n                </div>\n                <i class="load-spin fas fa-spinner d-flex align-items-center"></i>\n              </button>\n              <div class="d-flex list-group-item-controls">\n                <form enctype="multipart/form-data" method="POST" target="hiddenframe" action="/api/csvPush" class="d-flex flex-column justify-content-center py-2 mr-1">\n                  <input type="hidden" name="pool" value="').concat(el._id,'">\n                  <label class="btn btn-secondary m-0"  data-toggle="tooltip"  title="Load CSV">\n                    <input type="file" name="filename"  hidden onchange="this.form.submit();">\n                    <i class="fas fa-file-upload"></i>\n                  </label>\n                </form>\n                <form enctype="multipart/form-data" method="POST" target="hiddenframe" action="/api/poolRemove?id=').concat(el._id,'" class="d-flex flex-column justify-content-center py-2">\n                  <input type="hidden" name="pool" value="').concat(el._id,'">\n                  <label class="btn btn-danger m-0 list-group-item-delete"  data-toggle="tooltip"  title="Delete this pool">\n                    <input type="submit" name="filename" hidden >\n                    <i class="fas fa-trash-alt"></i>\n                  </label>\n                </form>\n              </div>\n            </div>\n            ');container.append(block)}$("#linkCreate").click(function(){var fromOp=$("#linkCreateParent").val(),toOp=$("#linkCreateChild").val();$.get("/api/linkCreate?poolId=".concat(selectedPool,"&from=").concat(fromOp,"&to=").concat(toOp),function(data){$.get("/api/poolAggregate?idpool=".concat(selectedPool),function(data){$("#chart").flowchart("setData",data)},"json")})})},"json")}$(".btn.list-group-item-delete").click(function(){$("#chart").flowchart("redrawLinksLayer"),$(this).closest(".list-group-item-action").remove()}),loadPool(),$("#poolReload").click(function(){$("#poolList").html(""),loadPool()}),$(".list-group-item-delete").click(function(){$("#poolList").html(""),loadPool()}),$("#createNewPool").click(function(){var name=$("#newPoolName").val(),desc=$("#newPoolDescription").val();if(!name)return alert("Please, set a pool name!"),!1;$.get("/api/poolCreate?name=".concat(name,"&description=").concat(desc),function(data){$("#poolList").append('<div class="list-group-item list-group-item-action d-flex justify-content-between flex-row align-items-center py-0 px-2  ">\n            <button onclick="$.get(\'/api/poolAggregate?idpool='.concat(data,"',function (data) {$('#chart').flowchart('setData', data)}, 'json'); $('#headerTitle').html('").concat(name,'\'); disableOpt(true)" class="list-group-item-button" style="color: inherit">\n              <div class="d-flex w-100 alighn-items-center flex-column">\n                <h6 class="list-group-item-name">').concat(name,"</h6>\n                ").concat(desc?'<small class="list-group-item-desc">'+desc+"</small>":"",'\n              </div>\n              <i class="load-spin fas fa-spinner d-flex align-items-center"></i>\n            </button>\n            <div class="d-flex list-group-item-controls">\n              <form enctype="multipart/form-data" method="POST" target="hiddenframe" action="/api/csvPush" class="d-flex flex-column justify-content-center py-2 mr-1">\n                <input type="hidden" name="pool" value="').concat(data,'">\n                <label class="btn btn-secondary m-0"  data-toggle="tooltip"  title="Load CSV">\n                  <input type="file" name="filename"  hidden onchange="this.form.submit();">\n                  <i class="fas fa-file-upload"></i>\n                </label>\n              </form>\n              <form enctype="multipart/form-data" method="POST" target="hiddenframe" action="/api/poolRemove?id=').concat(data,'" class="d-flex flex-column justify-content-center py-2">\n                <input type="hidden" name="pool" value="').concat(data,'">\n                <label class="btn btn-danger m-0 list-group-item-delete"  data-toggle="tooltip"  title="Delete this pool">\n                  <input type="submit" name="filename"  hidden >\n                  <i class="fas fa-trash-alt"></i>\n                </label>\n              </form>\n            </div>\n          </div>\n          '))})})});